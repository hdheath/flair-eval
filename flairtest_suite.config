// Test case definitions refer to dataset parameters (reads/genome/gtf/...)
params {
    test_cases = [
        [
            name : 'trial',
            conda: '/private/home/hdheath/miniconda3/envs/flair',
            steps: [
                [
                    cmd    : "flair align -r \${params.reads} -g \${params.genome} -o yeast",
                    cpus   : 4,
                    mem    : '30 GB',
                    time   : '2h',
                    publish: 'align_out'
                ],
                [
                    cmd    : "flair correct -q {{prev}}/yeast.bed -g \${params.genome} -f \${params.gtf}",
                    cpus   : 2,
                    mem    : '10 GB',
                    time   : '3h',
                    publish: 'correct_out'
                ],
                [
                    cmd    : "flair collapse -r \${params.reads} -q {{prev}}/flair_all_corrected.bed -g \${params.genome} -f \${params.gtf} --check_splice",
                    cpus   : 2,
                    mem    : '10 GB',
                    time   : '3h',
                    publish: 'collapse_out'
                ], 
                [
                    cmd    : """
                        sqanti3_qc \
                            {{prev}}/flair.collapse.isoforms.gtf \
                            \${params.gtf} \
                            \${params.genome} \
                            --CAGE_peak \${params.cage} \
                            --polyA_peak \${params.quantseq} \
                            -c \${params.junctions}\
                            --output human_flair2 \
                            --dir ./human_flair2 \
                            --skipORF \
                            --cpus 8 \
                            --report pdf
                    """,
                    cpus   : 8,
                    mem    : '16 GB',
                    time   : '2h',
                    publish: 'sqanti_qc',
                    runtime: 'sqanti'
                ]


            ]
        ],
        [
            name : 'flair_correct_reuse',
            conda: '/private/home/hdheath/miniconda3/envs/flair',
            reuse_from: 'trial',
            steps: [
                [
                    cmd    : "flair correct -q {{reuse}}/yeast.bed -g \${params.genome} -f \${params.gtf}",
                    cpus   : 4,
                    mem    : '10 GB',
                    time   : '3h',
                    publish: 'correct_out'
                ]
                
            ]
        ], 
                [
            name : 'test_target_loci',
            conda: '/private/home/hdheath/miniconda3/envs/flair',
            reuse_from: 'trial',
            steps: [
                [
                    cmd    : """
                    target_loci.py \
                        --regions \${params.target_regions} \
                        --bam {{reuse}}/yeast.bam \
                        --bed {{reuse}}/yeast.bed \
                        --gtf \${params.gtf} \
                        -o targeted_loci
                    """,
                    cpus   : 4,
                    mem    : '10 GB',
                    time   : '3h',
                    publish: 'targeted_loci'
                ],
                [
                    cmd    : "flair correct -q {{prev}}/targeted_loci.bed -g \${params.genome} -f \${params.gtf}",
                    cpus   : 2,
                    mem    : '10 GB',
                    time   : '3h',
                    publish: 'targeted_loci_correct_out'
                ], 

            ]
        ], 
        [
            name : 'trial_collapse_check_splice',
            conda: '/private/home/hdheath/miniconda3/envs/flair',
            reuse_from: 'trial',
            steps: [
                [
                    cmd    : "flair collapse -r \${params.reads} -q {{reuse}}/correct_out/flair_all_corrected.bed -g \${params.genome} -f \${params.gtf} --check_splice",
                    cpus   : 2,
                    mem    : '10 GB',
                    time   : '3h',
                    publish: 'collapse_out'
                ], 
                ]
        ],

        [
            name : 'A549_dRNA',
            conda: '/private/groups/brookslab/hdheath/tools/flair-fusion',
            steps: [
                [
                    cmd    : "/private/groups/brookslab/bin/intronProspector --genome-fasta=\${params.genome} --intron-bed6=A549_dRNA_junctions.bed -C 0.0 \${params.alignment}",
                    cpus   : 2,
                    mem    : '10 GB',
                    time   : '3h',
                    publish: 'collapse_out'
                ], 
                ]
        ]

        
    ]
}
